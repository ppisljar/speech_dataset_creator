<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Management System</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="web/css/main.css">
    <link rel="stylesheet" href="web/components/data-viewer/data-viewer.css">
    <!-- NProgress CSS for HTTP request progress bar -->
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
</head>
<body>
    <div class="container">
        <div class="main-header">
            <div class="logo-section">
                <div class="logo-icon">
                    S
                </div>
                <h1>Speech Dataset Creator</h1>
            </div>
            <div class="status-icon-container">
                <div class="status-icon" onclick="loadProcessingStatus()" title="Processing Status">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </div>
                <div class="status-tooltip" id="statusTooltip">
                    <div class="status-tooltip-header">
                        <span>Processing Status</span>
                        <button onclick="refreshProcessingStatus()" class="refresh-btn" title="Refresh">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="statusTooltipContent" class="status-tooltip-content">
                        No processing activities found.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Project Header with unified controls -->
        <div class="project-header">
            <h2>Project:</h2>
            <div class="project-controls">
                <select id="globalProjectSelect">
                    <option value="">Select Project</option>
                </select>
                <div class="icon-buttons">
                    <button class="icon-btn" onclick="showAddProjectModal()" data-tooltip="Add Project">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                    </button>
                    <button class="icon-btn" onclick="deleteSelectedProject()" id="deleteProjectBtn" disabled data-tooltip="Delete Project">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        </svg>
                    </button>
                    <button class="icon-btn" onclick="showEditProjectModal()" id="editProjectBtn" disabled data-tooltip="Edit Project">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                    </button>
                </div>
                <div class="file-controls">
                    <button class="icon-btn" id="addFilesBtn" onclick="showAddFilesModal()" data-tooltip="Add Files">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M11,15V12H9V10H11V7H13V10H15V12H13V15H11Z"/>
                        </svg>
                    </button>
                    <button class="icon-btn" id="addUrlsBtn" onclick="showAddUrlsModal()" data-tooltip="Add URLs">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16,6H13V7.9H16C18.26,7.9 20.1,9.73 20.1,12A4.1,4.1 0 0,1 16,16.1H13V18H16A6,6 0 0,0 22,12C22,8.68 19.31,6 16,6M10.9,12C10.9,9.73 9.06,7.9 6.8,7.9H4V6H6.8C10.15,6 12.9,8.68 12.9,12C12.9,15.32 10.15,18 6.8,18H4V16.1H6.8C9.06,16.1 10.9,14.27 10.9,12M8,11V13H16V11H8Z"/>
                        </svg>
                    </button>
                    <button class="icon-btn run-btn" onclick="runAllFiles()" id="runAllBtn" disabled data-tooltip="Run All Files">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                        </svg>
                    </button>
                    <button class="icon-btn clean-btn" onclick="cleanProject()" id="cleanProjectBtn" disabled data-tooltip="Clean Project">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                        </svg>
                    </button>
                    <button class="icon-btn export-btn" onclick="exportProject()" id="exportProjectBtn" disabled data-tooltip="Export Project">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M15,11H13V16L15.5,13.5L17,15L12,20L7,15L8.5,13.5L11,16V11H9L12,8L15,11Z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="section" id="dataViewerSection">
            <h2>Data Viewer</h2>
            <!-- Data Viewer Component -->
            <div id="dataViewerComponent"></div>
        </div>

        <div id="messages"></div>
    </div>

    <!-- Run All Options Modal -->
    <div id="runAllOptionsModal" class="modal">
        <div class="modal-content run-all-options-modal">
            <div class="modal-header">
                <h3>Run All Processing Options</h3>
                <span class="close" onclick="closeModal('runAllOptionsModal')">&times;</span>
            </div>
            <div class="run-options-container">
                <p class="options-description">Select the processing steps you want to run on all files in this project:</p>
                
                <div class="options-grid">
                    <div class="option-group">
                        <h4>Basic Processing</h4>
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_override">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Override Existing Files</span>
                                <span class="option-desc">Overwrite existing output files during processing</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_skip">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Skip Incomplete Splits</span>
                                <span class="option-desc">Skip processing split files if audio and silence files exist but transcription doesn't</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="option-group">
                        <h4>Advanced Processing</h4>
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_segment">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Enable Segmentation</span>
                                <span class="option-desc">Segment audio files based on speaker detection and timing</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="option-group">
                        <h4>Quality Control</h4>
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_validate">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Run Validation</span>
                                <span class="option-desc">Validate transcription quality of processed segments</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_clean">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Clean Failed Segments</span>
                                <span class="option-desc">Remove segments that fail validation (requires validation)</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="option-group">
                        <h4>Output Generation</h4>
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_copy">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Copy Good Segments</span>
                                <span class="option-desc">Copy validated segments to project/audio folder with speaker organization</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="runOption_meta">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Generate Metadata</span>
                                <span class="option-desc">Create metadata.csv file for the processed dataset</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="preset-buttons">
                    <button onclick="setPreset('none')" class="preset-btn">None</button>
                    <button onclick="setPreset('basic')" class="preset-btn">Basic</button>
                    <button onclick="setPreset('full')" class="preset-btn">Full Pipeline</button>
                </div>
            </div>
            <div class="button-group">
                <button onclick="closeModal('runAllOptionsModal')">Cancel</button>
                <button onclick="startRunAllProcessing()" class="run-btn">Start Processing</button>
            </div>
        </div>
    </div>

    <!-- Clean Options Modal -->
    <div id="cleanOptionsModal" class="modal">
        <div class="modal-content clean-options-modal">
            <div class="modal-header">
                <h3>Clean Project Data</h3>
                <span class="close" onclick="closeModal('cleanOptionsModal')">&times;</span>
            </div>
            <div class="clean-options-container">
                <p class="options-description">Select what you want to clean from this project. <strong>Warning:</strong> This action cannot be undone!</p>
                
                <div class="options-grid">
                    <div class="option-group">
                        <h4>Project Directories</h4>
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_raw">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Raw Audio Files</span>
                                <span class="option-desc">Delete all original uploaded audio files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_splits_full">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Splits (Complete)</span>
                                <span class="option-desc">Delete entire splits directory including all processed files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_splits_partial">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Splits (Keep Audio)</span>
                                <span class="option-desc">Delete subfolders but keep cleaned audio files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_audio">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Audio Output</span>
                                <span class="option-desc">Delete final processed audio output directory</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="option-group">
                        <h4>Split File Types</h4>
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_silence">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Silence Files</span>
                                <span class="option-desc">Delete silence detection JSON files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_pyannote_csv">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Pyannote CSV</span>
                                <span class="option-desc">Delete pyannote speaker diarization CSV files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_pyannote_rttm">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Pyannote RTTM</span>
                                <span class="option-desc">Delete pyannote RTTM format files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_transcription">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Transcription Files</span>
                                <span class="option-desc">Delete speech-to-text transcription JSON files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_wespeaker">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">WeSpeaker Files</span>
                                <span class="option-desc">Delete WeSpeaker diarization output files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_3dspeaker">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">3DSpeaker Files</span>
                                <span class="option-desc">Delete 3D-Speaker diarization output files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_speakerdb">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Speaker Database</span>
                                <span class="option-desc">Delete speaker.db files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_segments">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Segment Files</span>
                                <span class="option-desc">Delete segment JSON configuration files</span>
                            </div>
                        </label>
                        
                        <label class="option-checkbox">
                            <input type="checkbox" id="cleanOption_raw_segments">
                            <span class="checkmark"></span>
                            <div class="option-info">
                                <span class="option-title">Raw Segments</span>
                                <span class="option-desc">Delete raw segment audio files</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="preset-buttons">
                    <button onclick="setCleanPreset('none')" class="preset-btn">None</button>
                    <button onclick="setCleanPreset('processing')" class="preset-btn">Processing Files</button>
                    <button onclick="setCleanPreset('all')" class="preset-btn">Everything</button>
                </div>
            </div>
            <div class="button-group">
                <button onclick="closeModal('cleanOptionsModal')">Cancel</button>
                <button onclick="startCleanOperation()" class="clean-btn">Clean Selected</button>
            </div>
        </div>
    </div>

    <!-- Add Files Modal -->
    <div id="addFilesModal" class="modal">
        <div class="modal-content add-files-modal">
            <div class="modal-header">
                <h3>Add Files to Project</h3>
                <span class="close" onclick="closeModal('addFilesModal')">&times;</span>
            </div>
            <div class="file-upload-area">
                <div id="dragDropArea" class="drag-drop-area">
                    <div class="drag-drop-content">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="#007bff">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M11,15V12H9V10H11V7H13V10H15V12H13V15H11Z"/>
                        </svg>
                        <h4>Drag & Drop Files Here</h4>
                        <p>Or click to browse files</p>
                        <p class="supported-formats">Supported: .mp3, .wav, .m4a, .flac</p>
                    </div>
                    <input type="file" id="fileUploadInput" multiple accept=".mp3,.wav,.m4a,.flac,audio/*" style="display: none;">
                </div>
                <div id="selectedFilesList" class="selected-files-list">
                    <!-- Selected files will appear here -->
                </div>
            </div>
            <div class="button-group">
                <button onclick="closeModal('addFilesModal')">Cancel</button>
                <button onclick="uploadSelectedFiles()" id="uploadFilesBtn" disabled>Upload Files</button>
            </div>
        </div>
    </div>

    <!-- Add URLs Modal -->
    <div id="addUrlsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add URLs to Project</h3>
                <span class="close" onclick="closeModal('addUrlsModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="urlsTextarea">Audio File URLs (one per line):</label>
                <textarea id="urlsTextarea" rows="10" placeholder="Paste your audio file URLs here, one per line.&#10;&#10;Example:&#10;https://example.com/audio1.mp3&#10;https://example.com/audio2.wav&#10;https://example.com/audio3.m4a" style="width: 100%; font-family: monospace; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
            </div>
            <div class="form-group">
                <small style="color: #666;">Supported formats: MP3, WAV, M4A, FLAC. Files will be automatically converted to WAV format.</small>
            </div>
            <div class="button-group">
                <button onclick="closeModal('addUrlsModal')">Cancel</button>
                <button onclick="submitUrls()" id="submitUrlsBtn">Download URLs</button>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div id="addProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Project</h3>
                <span class="close" onclick="closeModal('addProjectModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="modalProjectName">Project Name:</label>
                <input type="text" id="modalProjectName" placeholder="Enter project name">
            </div>
            <div class="form-group">
                <label for="modalSilenceThreshold">Silence Threshold (dB):</label>
                <input type="number" id="modalSilenceThreshold" value="-45" step="1" min="-100" max="0">
            </div>
            <div class="form-group">
                <label for="modalMinSilenceLength">Minimum Silence Length (ms):</label>
                <input type="number" id="modalMinSilenceLength" value="100" step="100" min="100">
            </div>
            <div class="form-group">
                <label for="modalMaxSpeakers">Max Speakers (0 = auto-detect):</label>
                <input type="number" id="modalMaxSpeakers" value="0" step="1" min="0" max="20">
            </div>
            <div class="form-group">
                <label for="modalSilencePad">Silence Padding (ms):</label>
                <input type="number" id="modalSilencePad" value="50" step="10" min="0" max="500">
            </div>
            <div class="form-group">
                <label for="modalLanguage">Transcription Language:</label>
                <select id="modalLanguage">
                    <option value="sl">Slovenian (sl)</option>
                    <option value="en">English (en)</option>
                    <option value="de">German (de)</option>
                    <option value="fr">French (fr)</option>
                    <option value="es">Spanish (es)</option>
                    <option value="it">Italian (it)</option>
                    <option value="pt">Portuguese (pt)</option>
                    <option value="nl">Dutch (nl)</option>
                    <option value="pl">Polish (pl)</option>
                    <option value="cs">Czech (cs)</option>
                    <option value="sk">Slovak (sk)</option>
                    <option value="hr">Croatian (hr)</option>
                    <option value="sr">Serbian (sr)</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="modalBuildSubsegments" checked>
                    Build Subsegments
                </label>
                <small>Generate subsegments from main segments based on pauses and punctuation</small>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="modalJoinSubsegments">
                    Join Subsegments
                </label>
                <small>Create additional subsegments by joining consecutive subsegments (requires Build Subsegments)</small>
            </div>
            <div class="button-group">
                <button onclick="closeModal('addProjectModal')">Cancel</button>
                <button onclick="createProjectWithSettings()">Create Project</button>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="editProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Project</h3>
                <span class="close" onclick="closeModal('editProjectModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="editProjectName">Project Name:</label>
                <input type="text" id="editProjectName" placeholder="Enter project name">
            </div>
            <div class="form-group">
                <label for="editSilenceThreshold">Silence Threshold (dB):</label>
                <input type="number" id="editSilenceThreshold" value="-40" step="1" min="-100" max="0">
            </div>
            <div class="form-group">
                <label for="editMinSilenceLength">Minimum Silence Length (ms):</label>
                <input type="number" id="editMinSilenceLength" value="500" step="100" min="100">
            </div>
            <div class="form-group">
                <label for="editMaxSpeakers">Max Speakers (0 = auto-detect):</label>
                <input type="number" id="editMaxSpeakers" value="0" step="1" min="0" max="20">
            </div>
            <div class="form-group">
                <label for="editSilencePad">Silence Padding (ms):</label>
                <input type="number" id="editSilencePad" value="50" step="10" min="0" max="500">
            </div>
            <div class="form-group">
                <label for="editLanguage">Transcription Language:</label>
                <select id="editLanguage">
                    <option value="sl">Slovenian (sl)</option>
                    <option value="en">English (en)</option>
                    <option value="de">German (de)</option>
                    <option value="fr">French (fr)</option>
                    <option value="es">Spanish (es)</option>
                    <option value="it">Italian (it)</option>
                    <option value="pt">Portuguese (pt)</option>
                    <option value="nl">Dutch (nl)</option>
                    <option value="pl">Polish (pl)</option>
                    <option value="cs">Czech (cs)</option>
                    <option value="sk">Slovak (sk)</option>
                    <option value="hr">Croatian (hr)</option>
                    <option value="sr">Serbian (sr)</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="editBuildSubsegments" checked>
                    Build Subsegments
                </label>
                <small>Generate subsegments from main segments based on pauses and punctuation</small>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="editJoinSubsegments">
                    Join Subsegments
                </label>
                <small>Create additional subsegments by joining consecutive subsegments (requires Build Subsegments)</small>
            </div>
            <div class="button-group">
                <button onclick="closeModal('editProjectModal')">Cancel</button>
                <button onclick="updateProjectWithSettings()">Update Project</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="web/js/main.js"></script>
    <script src="web/js/audio-controller.js"></script>
    <script src="web/js/segments-manager.js"></script>
    <script src="web/components/data-viewer/data-viewer.js"></script>
    
    <script>
        // Configure NProgress
        NProgress.configure({ 
            showSpinner: false,
            minimum: 0.08,
            easing: 'ease',
            speed: 200
        });

        // Track active HTTP requests
        let activeRequests = 0;

        // Override fetch to automatically show/hide progress bar
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            // Start progress if this is the first request
            if (activeRequests === 0) {
                NProgress.start();
            }
            activeRequests++;

            return originalFetch.apply(this, args)
                .then(response => {
                    activeRequests--;
                    // Complete progress if this was the last request
                    if (activeRequests === 0) {
                        NProgress.done();
                    }
                    return response;
                })
                .catch(error => {
                    activeRequests--;
                    // Complete progress even on error
                    if (activeRequests === 0) {
                        NProgress.done();
                    }
                    throw error;
                });
        };

        // Initialize the data viewer component when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load the data viewer HTML into the component container
            fetch('web/components/data-viewer/data-viewer.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('dataViewerComponent').innerHTML = html;
                    // Setup data viewer listeners after the component is loaded
                    if (window.podcastManager) {
                        window.podcastManager.setupDataViewerListeners();
                    }
                })
                .catch(error => {
                    console.error('Error loading data viewer component:', error);
                });
        });
    </script>
</body>
</html>
